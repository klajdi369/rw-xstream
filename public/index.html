<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IPTV Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/mpegts.js@latest/dist/mpegts.js"></script>
  <style>
    :root {
      --bg:    #090b0e;
      --panel: rgba(10,14,20,.97);
      --line:  #1e2738;
      --text:  #e8f0fa;
      --muted: #7a90aa;
      --acc:   #1dd1a1;
      --foc:   #3aa0ff;
      --ih:    76px;
      --font:  ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; overflow: hidden; background: #000; }
    body { font-family: var(--font); color: var(--text); }

    #videoLayer { position: fixed; inset: 0; z-index: 1; background: #000; }
    #video { width: 100%; height: 100%; display: block; object-fit: contain; }

    #hud {
      position: fixed; bottom: 48px; left: 48px; right: 48px;
      z-index: 5; display: flex; align-items: flex-end;
      justify-content: space-between; gap: 24px;
      pointer-events: none; transition: opacity .4s;
    }
    #hud.hide { opacity: 0; pointer-events: none; }
    .hudInfo {
      background: rgba(0,0,0,.8); border: 1px solid rgba(255,255,255,.13);
      backdrop-filter: blur(16px); border-radius: 18px; padding: 16px 24px; max-width: 64%;
    }
    .hudTitle { font-size: 26px; font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; }
    .hudSub   { font-size: 16px; color: rgba(232,240,250,.72); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    #epgBlock { margin-top: 10px; border-top: 1px solid rgba(255,255,255,.1); padding-top: 10px; display: none; }
    #epgBlock.show { display: block; }
    .epgNow { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
    .epgNowTitle { font-size: 15px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
    .epgTime { font-size: 13px; color: rgba(232,240,250,.6); white-space: nowrap; flex-shrink: 0; }
    .epgBar { height: 3px; background: rgba(255,255,255,.12); border-radius: 2px; margin-bottom: 7px; overflow: hidden; }
    .epgBarFill { height: 100%; background: var(--acc); border-radius: 2px; transition: width .5s; }
    .epgNext { font-size: 13px; color: rgba(232,240,250,.55); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .hudHint {
      background: rgba(0,0,0,.65); border: 1px solid rgba(255,255,255,.1);
      backdrop-filter: blur(12px); border-radius: 18px; padding: 14px 20px;
      font-size: 15px; line-height: 1.85; color: rgba(232,240,250,.78); text-align: right;
      pointer-events: auto;
    }
    #settingsBtn {
      display: block; margin-top: 10px; padding: 7px 14px;
      background: rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,.15);
      border-radius: 10px; color: var(--text); font-size: 14px; font-weight: 600;
      cursor: pointer; text-align: center; transition: background .12s;
    }
    #settingsBtn:hover, #settingsBtn.focused { background: rgba(58,160,255,.25); border-color: var(--foc); }

    #resumeBadge {
      position: fixed; top: 32px; right: 36px; z-index: 6;
      background: rgba(0,0,0,.75); border: 1px solid rgba(255,255,255,.13);
      backdrop-filter: blur(10px); border-radius: 14px; padding: 10px 18px;
      font-size: 15px; display: none; pointer-events: none;
    }
    #resumeBadge.show { display: block; }

    #backdrop {
      position: fixed; inset: 0; z-index: 9;
      background: rgba(0,0,0,.55); opacity: 0;
      pointer-events: none; transition: opacity .25s;
    }
    #backdrop.open { opacity: 1; pointer-events: auto; }

    #sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: 720px; z-index: 10; display: flex;
      transform: translateX(-100%);
      transition: transform .26s cubic-bezier(.4,0,.2,1);
    }
    #sidebar.open { transform: translateX(0); }

    .panel {
      display: flex; flex-direction: column; height: 100%;
      background: var(--panel); border-right: 1px solid var(--line); overflow: hidden;
    }
    #catPanel { width: 270px; flex-shrink: 0; }
    #chPanel  { flex: 1; min-width: 0; }

    .panelHead {
      padding: 20px 20px 16px; background: rgba(0,0,0,.3);
      border-bottom: 1px solid var(--line); flex-shrink: 0;
      display: flex; align-items: center; justify-content: space-between;
      border-left: 3px solid transparent; transition: border-color .15s;
    }
    .panel.active .panelHead  { border-left-color: var(--foc); }
    #chPanel.active .panelHead{ border-left-color: var(--acc); }
    .panelHead .ttl { font-size: 19px; font-weight: 800; }
    .badge { font-size: 12px; color: var(--muted); padding: 3px 9px; border: 1px solid var(--line); border-radius: 999px; }

    .searchWrap { padding: 10px; border-bottom: 1px solid var(--line); flex-shrink: 0; }
    .sInput {
      width: 100%; font-size: 17px; padding: 10px 14px;
      border-radius: 10px; border: 1px solid var(--line);
      background: rgba(0,0,0,.3); color: var(--text); outline: none;
    }
    .sInput:focus { border-color: rgba(58,160,255,.7); }

    .vScroll { flex: 1; position: relative; overflow-y: auto; overflow-x: hidden; min-height: 0; scrollbar-width: thin; scrollbar-color: #2a3444 transparent; }
    .vSpacer { position: absolute; top: 0; left: 0; width: 1px; pointer-events: none; }
    .vWindow { position: absolute; inset: 0; }

    .item {
      position: absolute; left: 8px; right: 8px; height: 70px;
      padding: 0 16px; border-radius: 12px; border: 2px solid transparent;
      display: flex; align-items: center; gap: 14px;
      cursor: pointer; user-select: none; background: rgba(255,255,255,.025);
      transition: background .07s, border-color .07s;
    }
    .item:hover { background: rgba(255,255,255,.06); }
    .item.sel { border-color: var(--foc); background: rgba(58,160,255,.12); }
    .item.playing { border-color: var(--acc); }
    .item.sel.playing { border-color: var(--acc); background: rgba(29,209,161,.1); }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: #2c3b4e; flex-shrink: 0; }
    .item.playing .dot { background: var(--acc); box-shadow: 0 0 8px rgba(29,209,161,.8); }
    .meta { min-width: 0; flex: 1; display: flex; flex-direction: column; gap: 3px; }
    .iname { font-size: 16px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .isub { font-size: 12px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .spinner { display: flex; align-items: center; justify-content: center; gap: 10px; padding: 40px 0; color: var(--muted); font-size: 15px; }
    .spin { width: 20px; height: 20px; border: 2px solid var(--line); border-top-color: var(--acc); border-radius: 50%; animation: rot .7s linear infinite; }
    @keyframes rot { to { transform: rotate(360deg); } }

    #settingsOverlay {
      position: fixed; inset: 0; z-index: 100;
      display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.75); backdrop-filter: blur(14px);
    }
    #settingsOverlay.show { display: flex; }
    #settingsCard {
      width: min(820px, 94vw); border-radius: 20px;
      border: 1px solid rgba(255,255,255,.13);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      box-shadow: 0 20px 60px rgba(0,0,0,.5); padding: 28px;
    }
    #settingsCard h2 { margin: 0 0 6px; font-size: 22px; }
    #settingsCard .sub { margin: 0 0 20px; color: rgba(232,240,250,.55); font-size: 14px; }
    .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }
    .field label { font-size: 13px; color: rgba(232,240,250,.75); }
    .field input {
      font-size: 16px; padding: 12px 14px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,.13);
      background: rgba(0,0,0,.28); color: var(--text); outline: none;
    }
    .field input:focus { border-color: rgba(58,160,255,.8); box-shadow: 0 0 0 3px rgba(58,160,255,.15); }
    .toggleRow {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 0; border-top: 1px solid var(--line); margin-top: 4px;
    }
    .toggleRow .tLabel { font-size: 16px; font-weight: 600; }
    .toggleRow .tDesc { font-size: 13px; color: var(--muted); margin-top: 2px; }
    .toggle { position: relative; width: 54px; height: 30px; cursor: pointer; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .toggleSlider {
      position: absolute; inset: 0; border-radius: 999px;
      background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.15);
      transition: background .2s;
    }
    .toggleSlider::after {
      content: ''; position: absolute; top: 3px; left: 3px;
      width: 22px; height: 22px; border-radius: 50%;
      background: var(--muted); transition: transform .2s, background .2s;
    }
    .toggle input:checked + .toggleSlider { background: rgba(29,209,161,.3); border-color: var(--acc); }
    .toggle input:checked + .toggleSlider::after { transform: translateX(24px); background: var(--acc); }
    .settActions { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin-top: 16px; }
    .btn { font-size: 15px; font-weight: 700; padding: 11px 20px; border-radius: 10px; border: 1px solid rgba(255,255,255,.13); background: rgba(255,255,255,.07); color: var(--text); cursor: pointer; transition: background .1s; }
    .btn:hover { background: rgba(255,255,255,.14); }
    .btnP { background: rgba(29,209,161,.18); border-color: rgba(29,209,161,.4); }
    .btnP:hover { background: rgba(29,209,161,.28); }
    .btnD { background: rgba(255,77,77,.1); border-color: rgba(255,77,77,.3); }
    .msg { font-size: 13px; }
    .err { color: rgba(255,100,100,.9); }
    .ok { color: rgba(232,240,250,.55); }
    .progBar { height: 3px; background: rgba(29,209,161,.2); border-radius: 2px; margin-top: 14px; overflow: hidden; }
    .progFill { height: 100%; background: var(--acc); border-radius: 2px; transition: width .3s; width: 0; }

    #connectingScreen {
      position: fixed; inset: 0; z-index: 50;
      display: none; align-items: center; justify-content: center; flex-direction: column; gap: 20px;
      background: rgba(0,0,0,.88); backdrop-filter: blur(10px);
    }
    #connectingScreen.show { display: flex; }
    #connectingScreen .bigSpin { width: 48px; height: 48px; border: 3px solid rgba(255,255,255,.1); border-top-color: var(--acc); border-radius: 50%; animation: rot .8s linear infinite; }
    #connectingScreen .cMsg { font-size: 18px; color: rgba(232,240,250,.7); }
    #connectingScreen .progBar { width: 240px; }
  </style>
</head>
<body>
<div id="videoLayer"><video id="video" autoplay playsinline></video></div>
<div id="hud" class="hide">
  <div class="hudInfo">
    <div class="hudTitle" id="hudTitle">IPTV Player</div>
    <div class="hudSub" id="hudSub">Press OK to open channel list</div>
    <div id="epgBlock">
      <div class="epgNow"><span class="epgNowTitle" id="epgNowTitle"></span><span class="epgTime" id="epgNowTime"></span></div>
      <div class="epgBar"><div class="epgBarFill" id="epgBarFill"></div></div>
      <div class="epgNext" id="epgNext"></div>
    </div>
  </div>
  <div class="hudHint">OK — open list<br>↑ ↓ — prev / next<br>← — categories<br>Back — close<br><button id="settingsBtn">⚙ Settings</button></div>
</div>
<div id="resumeBadge"></div>
<div id="backdrop"></div>
<div id="sidebar">
  <div class="panel" id="catPanel">
    <div class="panelHead"><span class="ttl">Categories</span><span class="badge" id="catBadge">0</span></div>
    <div class="searchWrap"><input class="sInput" id="catSearch" placeholder="Search…" autocomplete="off" /></div>
    <div class="vScroll" id="catScroll"><div class="vSpacer" id="catSpacer"></div><div class="vWindow" id="catWin"></div></div>
  </div>
  <div class="panel" id="chPanel">
    <div class="panelHead"><span class="ttl" id="chTitle">Channels</span><span class="badge" id="chBadge">0</span></div>
    <div class="searchWrap"><input class="sInput" id="chSearch" placeholder="Search…" autocomplete="off" /></div>
    <div class="vScroll" id="chScroll"><div class="vSpacer" id="chSpacer"></div><div class="vWindow" id="chWin"></div></div>
  </div>
</div>
<div id="settingsOverlay">
  <div id="settingsCard">
    <h2>⚙ Settings</h2>
    <p class="sub">Connection settings and preferences. Press Back / Esc to close without saving.</p>
    <div class="row2">
      <div class="field"><label>Server URL</label><input id="inServer" value="http://line.tivi-ott.net" placeholder="http://server:8080" autocomplete="off" /></div>
      <div class="field"><label>Format</label><input id="inFormat" value="m3u8" placeholder="m3u8 or ts" autocomplete="off" /></div>
    </div>
    <div class="row2">
      <div class="field"><label>Username</label><input id="inUser" value="UMYLEJ" placeholder="username" autocomplete="off" /></div>
      <div class="field"><label>Password</label><input id="inPass" type="password" value="VFCED1" placeholder="password" autocomplete="off" /></div>
    </div>
    <div class="toggleRow">
      <div><div class="tLabel">Remember last channel</div><div class="tDesc">Automatically resume the last watched channel on startup</div></div>
      <label class="toggle"><input type="checkbox" id="togRemember" checked /><span class="toggleSlider"></span></label>
    </div>
    <div class="progBar"><div class="progFill" id="settProg"></div></div>
    <div class="settActions"><div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn btnP" id="btnConnect">Connect</button><button class="btn btnD" id="btnClear">Clear Saved</button></div><div id="settMsg" class="msg ok"></div></div>
  </div>
</div>
<div id="connectingScreen"><div class="bigSpin"></div><div class="cMsg" id="connectMsg">Connecting…</div><div class="progBar"><div class="progFill" id="connectProg"></div></div></div>
<script src="./app.js"></script>
</body>
</html>
